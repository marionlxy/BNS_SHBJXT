<div class="layer">
  <form id="gatherform" class="gatherform" method="post" action="${ctxPath!}/pt/menuwinconf/saveWindGatherUpdate">
    <input type="hidden" name="id" value="${list.id}">
    <table class="EditTable" width="100%">
    		<tbody>
    		<tr class="FormData"> 
    		<td></td>  			
			</tr>
    		
			<tr class="FormData">
				<td class="CaptionTD">类型:</td>
				<td class="DataTD"><span>采集框</span><input type="hidden" value="1" name="type" />
				</td>
			</tr>
			<tr class="FormData">
				<td class="CaptionTD">名称:</td>
				<td class="DataTD" ><input  type="text" name="name" style="font-size:12px;width:200px;" datatype="*" nullmsg="请输入名称！" ajaxurl="" value="${list.name}" />
				</td>
			</tr>
			<tr class="FormData">
				<td class="CaptionTD">绑定字段:</td>
				<td class="DataTD" >
					<select class="" name="bindFiled" style="font-size:12px;width:200px;" disabled>
	                @for(basDict in findSysList!){
							<option value="${basDict.id!}"
							@if(basDict.id==list.bindFiled){
								selected="selected"
							@}
							>
							  ${basDict.mapCnName!}
							</option>
						@}
	              </select>
				</td>
			</tr>
				<tr class="FormData">
				<td class="CaptionTD">指定分组:</td>
				<td class="DataTD" >
				<select class="" name="groupid" onchange="show_sub(this.options[this.options.selectedIndex].value)" style="font-size:12px;width:200px;">
	                 @for(bindGroup in findgrouplist!){
							<option value="${bindGroup.groupid!}"
							@if(bindGroup.groupid==list.groupid){
								selected="selected"
							@}
							>
							  ${bindGroup.name!}
							</option>
						@}
	              </select>
				</td>
			</tr>
			<tr class="FormData">
				<td class="CaptionTD">是否必填项:</td>
				<td class="">
				<input id="nullFlag" type="checkbox" value="" 
				@if(list.nullFlag=="0"){
					checked="checked"
					
				@}
				/>是必填项
				<input name="nullFlag" type="hidden"/>
				</td>
			</tr>
			<tr class="FormData">
				<td class="CaptionTD">采集框类型:</td>
				<td class="">
						<select id="collectType" class="" name="collectType" style="font-size:12px;width:200px;">
	                <option value='0' 
	                	@if(list.collectType=="0"){
	                		selected="selected"
	                	@}
	                >文本框</option>
	                
	                <option value='1'
	                	@if(list.collectType=="1"){
	                		selected="selected"
	                	@}
	                >下拉框</option>
	                
	                <option value='2'
	                	@if(list.collectType=="2"){
	                		selected="selected"
	                	@}
	                >日期框</option>
	                
	                <option value='3'
	                	@if(list.collectType=="3"){
	                		selected="selected"
	                	@}
	                >数字框</option>
	                
	                <option value='4'
	                	@if(list.collectType=="4"){
	                		selected="selected"
	                	@}
	                >单选弹出框</option>
	                
	                <option value='5'
	                	@if(list.collectType=="5"){
	                		selected="selected"
	                	@}
	                >多选弹出框</option>
	                
	                <option value='6'
	                	@if(list.collectType=="6"){
	                		selected="selected"
	                	@}
	                >文本域</option>
	                
	                <option value='7'
	                	@if(list.collectType=="7"){
	                		selected="selected"
	                	@}
	                >金额框</option>
	              </select>
				</td>
			</tr>
			<tr class="FormData">
				<td class="CaptionTD">采集框数据源:</td>
				<td class="">
				<select id="dataSource" class="dataSource" name="dataSource" style="font-size:12px;width:200px;">
							 <option value="">
							 --请选择--
							</option>
	              @for(codegroup in findcodegrouplist!){
							<option value="${codegroup.id!}"
								@if(codegroup.id==list.datasource){
									selected="selected"
								@}
							>
							  ${codegroup.codeGroupName!}
							</option>
						@}
	              </select>
				</td>
			</tr>	
			
			<tr class="FormData">
				<td class="CaptionTD">是否使用:</td>
				<td class="">
				<input id="useFlag" type="checkbox"
					@if(list.useFlag=="0"){
						checked="checked"
					@}
				/>使用
				<input name="useFlag" type="hidden"/>
				</td>
			</tr>
			
			<tr class="FormData">
				<td class="CaptionTD">是否可更改:</td>
				<td class="">
				<input id="alterFlag"  name="alterFlag" type="checkbox" value="1"
					@if(list.alterFlag=="1"){
						checked="checked"
					@}
				/>可更改
				</td>
			</tr>
			
			<tr class="FormData">
				<td class="CaptionTD">序号:</td>
				<td class="DataTD">
				<input id="orderCode" name="orderCode" type="text" value="${list.orderCode!}" style="font-size:12px;width:200px;"/>
				<input id="realCode"  name="realCode" type="hidden" value="${list.realCode!}"/>
				</td>
			</tr>
			
			<tr>
				<td> 
					<div class="clearfix" tag-save-btn style="bottom: 0px;left: 35%;position:absolute;">
						<button type="submit" class="btn btn-primary btn-sm bigger-110"  id="model-save-form">保存</button>&nbsp;&nbsp;
						<button type="reset" class="btn btn-primary btn-sm bigger-110" id="model-save-cancel">关闭</button>
					</div>
				</td>
			</tr>
			</tbody>
		
    </table>
   
  </form>   
</div>


<script type="text/javascript">
function show_sub(v){     
    var groupId = v.substring(0,3);
    $.ajax({
    	url: "${ctxPath}/pt/menuwinconf/getOrder?groupId="+groupId+"&functionCode=${functionCode!}",
        dataType: "json",
        async: false,
        method:"post",
        success: function(data) {
           $("#orderCode").val(data.ordercode);
           $("#realCode").val(data.realcode);
        }
    });
}    

$(function(){
	
	 $('#nullFlag').change(function(){
	    if($('#nullFlag').prop('checked')){
	    	$("input[name='nullFlag']").val("0");
	    }else{
	    	$("input[name='nullFlag']").val("1");
	    }
	  })
	  
	  
	 $('#useFlag').change(function(){
	    if($('#useFlag').prop('checked')){
	    	$("input[name='useFlag']").val("0");
	    }else{
	    	$("input[name='useFlag']").val("1");
	    }
	  })
		  
	var index = layer.index;
/*     var options ={   
            url:'${ctxPath!}/pt/ptcommission/saveCommission',   
            type:'post', 
            dataType:'html',
            data:jQuery("#gatherform").serialize(),
            success:function(data){
             if(data.statusCode=="OK") {  
                   
            	}else{

            	} 
            }   
         }; 
     var form =$("#gatherform");//form1:表单ID  在表单界面只用这一个表单ID    
         $("#model-save-form").click(function() {
       	  form.ajaxSubmit(options); 
             return false;
         });*/
	 var typeValue=$("#collectType").val();
    	if((typeValue!=null&&typeValue==1) || (typeValue!=null&&typeValue==5)){
           //$('#btnAddMoney').addClass('disabled'); // Disables visually
        	$('.dataSource').prop('disabled', false);
         }else{
         	// $('#btnAddMoney').addClass('disabled'); // Disables visually
         	$('.dataSource').prop('disabled', true); // Disables visually + functionally	
         }
     //选择下拉框事件
     $("#collectType").change(function(){	
         		var typeValue=$("#collectType").val();
               	if((typeValue!=null&&typeValue==1) || (typeValue!=null&&typeValue==5)){
                      //$('#btnAddMoney').addClass('disabled'); // Disables visually
                   	$('.dataSource').prop('disabled', false);
                    }else{
                    	// $('#btnAddMoney').addClass('disabled'); // Disables visually
                    	$('.dataSource').prop('disabled', true); // Disables visually + functionally	
                    }

         	  }); 
    
   $("#gatherform").Validform({
	   ajaxPost:true,
    	tiptype : 4,
        beforeSubmit:function(curform){
            var loadi = layer.load(5,2);
            $("#gatherform").data('loadi',loadi);
        },
        tiptype : function(msg, o, cssctl) {
            if (!o.obj.is("form")) {
                if (o.type != 2) {
                    tip.errorTip(msg,o.obj);
                }
            }
        },
        tipSweep : true,
        callback:function(data){
			layer.close($("#gatherform").data('loadi'));
			//alert(data);
			if(data.code=="1"){
				layer.msg(data.msg, 1, 1,function(){
					//query();
					//var treeNodes = [{"id":1, "pId":0, "name":"test1"}];
				});
				layer.closeAll('page'); 
				$("#alertInfo").bootstrapTable('refresh');
				//location.reload();
			}else{
				layer.msg(data.msg,3,1);
				//layer.closeAll('page');
			}
		}
    });

         
 
    // var index=layer.index;
    $("#model-save-cancel").click(function(){
        layer.close(index);
    });
    
    var arr = [1,5];
    if(!$.inArray(($("#collectType").find("option:selected").val(),arr))){
    	$("#dataSource").attr("disabled",true);
    }else{
    	$("#dataSource").attr("disabled",false);
    }
});
</script>

