<div class="row">
	<div class="col-xs-12">
		<div class="widget-box">
			<div class="widget-header widget-header-flat widget-header-small">
				<h6 class="widget-title">项目字段</h6>
				<div class="widget-toolbar">
					<a href="#" data-action="fullscreen" class="orange2" onclick="refreshTable('sysDicTable')">  <i
							class="ace-icon fa fa-expand"></i>
					</a>
				</div>
				<div class="widget-toolbar">
					<a  href="javascript:void(0);"class="btn btn-purple btn-xs" style="width:95px" id="saveUp">
						<i class="ace-icon fa fa-cloud-download bigger-130"></i>
						保存更新
					</a>
			     </div>
			</div>
			<div class="widget-body">
			<div id="list-page" class="widget-main padding-8">
				<table id="sysDicTable"></table>
			</div>
			</div>
		</div>
	</div>
</div>

<input type="hidden" value="${category}" name="category" id="category"/>
<script type="text/javascript">

//${ctxPath}/pt/ptSysDic/getSysDicList
$(function(){
	$("#sidebar-collapse").click(function(){
		refreshTable('sysDicTable');
	});
	
	var category= $("#category").val();
	$("#sysDicTable").bootstrapTable({
		inconSize : 'sm',
		url:'${ctxPath!}/pt/ptSysDic/getSysDicList?category='+category,
		striped : true,
		height:375,
		columns : [ {
			checkbox : true,
			formatter:formaCheck,
			field:"chk"
		}, {
			field : "id",
			title : '序号',
			formatter : function(value, row, index) {
				return index + 1;
			}
		}, {
			field : "enName",
			title : '英文名称',
			sortable : true
		}, {
			field : "cnName",
			title : '中文名称',
			sortable : true
		}, {
			field : "dataType",
			title : '数据类型',
			sortable : true,
			formatter : function(value, row, index) {
				if (value =="01") {
					return '数字';
				} else if(value == "02"){
					return '字符串';
				}else if(value == "03"){
					return '编码&名称';
				}else if(value == "04"){
					return '编码&名称';
				}else{
					return '金额';
				}
			}
		}, {
			field : "dateLenget",
			title : '长度',
			sortable : true
		}, {
			field : "precision",
			title : '精度',
			sortable : true
		}, {
			field : "mapCnName",
			title : '映射名称',
			sortable : true
		}, {
			field : "mapPrecision",
			title : '映射精度',
			sortable : true
		}, {
			field : "nullFlag",
			title : '允许为空',
			sortable : true,
			formatter : function(value, row, index) {
				if (value == 0) {
					return '可为空';
				} else {
					return '不可为空';
				}
			}
		},{
			field : "plateFlag",
			title : '平台标志',
			sortable : true,
			formatter : function(value, row, index) {
				if (value == 0) {
					return '是';
				} else {
					return '否';
				}
			}
			
		},{
			field : "state",
			title : '状态',
			sortable : true,
			formatter : function(value, row, index) {
				if (value == '0') {
					return '启用';
				} else {
					return '不启用';
				}
			}
			
		},{
			title: '操作',
	        field: 'id',
	        formatter:function(value,row,index){
	        	var edit='<a  href="javascript:void(0);"' +
					' data-mode="detail" data-title="编辑数据"' +
					' data-url="${ctxPath}/pt/ptSysDic/selectDicField?id='+row.id+'"'+
					'data-width="30%"' +
					'data-height="40%">'+
	                '<i class="ace-icon fa fa-pencil midder-130"></i>' +
					'</a>';
	        		 return edit;
	        }
			
		}]
	}); 
	
	//--------------判断是不是平台标志----------------------------------
	function formaCheck(value,row,index) {
		//alert(value);
		if (row.plateFlag == 0||row.plateFlag== '0'&&row.state == '0') {
			return {disabled:true,checked:true};
		}else if(row.state == '0'||row.state == 0){
			return {checked:true};
		}
	}; 
});


//----------------------------更改是不是启用------------------------------------
	$('#saveUp').click(function(){
		var rows = $("#sysDicTable").bootstrapTable('getData');
			var rowsTemp = new Array();
			for(var i=0;i<rows.length;i++){
				var row = rows[i];			
				if(row.plateFlag==1){
					var ids = {};
					ids["id"]=row.id;
					if(row.chk){
						ids["state"]="0";
					}else{
						ids["state"]="1";
					}
					rowsTemp.push(ids);
				}
			}
			var basdict = JSON.stringify(rowsTemp);
			//alert(basdict);
			 $.post("${ctxPath!}/pt/ptSysDic/saveUpState",{'basdict':basdict},function(result){
					if(result.code==1){
						layer.msg('修改成功!', 1, 1,function(){
                            
						$("#sysDicTable").bootstrapTable('refresh');
                        });	
					}else{
						layer.msg("修改失败!");
					}
				},"json");
	});

</script>











