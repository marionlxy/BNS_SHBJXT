<div class="row">
	<div class="col-xs-12">
		<div class="widget-box">
			<div class="widget-header widget-header-flat widget-header-small">
				<h5 class="widget-title">${mettingName!}</h5>
				<div class="widget-toolbar">
					<input type="text" value="${mettingId!}" name="mettingId" id="mettingId"/>
				</div>
				<div class="widget-toolbar no-border">
				</div>
				<div class="widget-toolbar no-border">
				</div>
			</div>
			<div class="widget-body">
				<div id="list-page" class="widget-main padding-8">
					<div id="toolbar1">
							<form method="post" class="form-search" id="dic-save" >
							<div class="form-inline" role="form">
								<div class="form-group">
									<a class="btn btn-primary btn-xs " href="javascript:void(0);" id="preparMet" onclick="preparMet({projectId:'0',functionCode:'fun1301'})">
							            <i class="fa fa-hand-o-up"></i>组建预备
						            </a>
                                    <a class="btn btn-primary btn-xs" href="javascript:void(0);" id="metDetail"> 
							            <i class="fa fa-hand-o-up"></i>会议详情
						            </a>
									<a href="javascript:void(0);" class="btn btn-primary btn-xs" ><i class="fa  fa-th-list"></i> <span id="hyzbsubmitForm">保存</span></a>
									<a href="javascript:void(0);" onclick="toPreConference()" class="btn btn-primary btn-xs"><i class="fa  fa-history"></i>&nbsp;取消</a>
									<a href="javascript:void(0);"  id="tocurrentmeeting" onclick="tocurrentmeeting({id:${id!}})" haschild="false" class="btn btn-success btn-xs"><i class="fa fa-check-circle"></i>&nbsp;指定为当前会议</a>
									<a class="btn btn-primary btn-xs" href="javascript:void(0);" id="addItemsList"> 
										<i class="fa  fa-plus-circle"></i>&nbsp;添加议题&nbsp;&nbsp;
										<!-- onclick="addItemsList({mettingId:${mettingId!},functionCode:'fun1306'})" -->
									</a>
									<a class="btn btn-primary btn-xs" style="width: 80px;" id="upPro()" onclick="updatePro()" href="javascript:void(0);"><i class="fa  fa-pencil-square"></i>&nbsp;修改议题</a>
                                    <a class="btn btn-primary btn-xs" id="quitMetting" href="javascript:void(0);"><i class="fa  fa-times-circle "></i>&nbsp;退出会议</a>
								    <a  class="btn btn-purple btn-xs" style="width: 80px;" id="up" onclick="up()" href="javascript:void(0);">&nbsp;&nbsp;<i class="fa  fa-level-up ">
										升序</i>&nbsp;&nbsp;&nbsp;</a>
									<a  class="btn btn-purple btn-xs" style="width: 80px;" id="down" onclick="down()" href="javascript:void(0);">&nbsp;&nbsp;<i class="fa  fa-level-down">
										降序</i>&nbsp;&nbsp;&nbsp;
									</a>
                                </div>
								<div class="form-group"></div>
								
							</div>
						</form>
					</div>
			
					<table id="preparTable"></table>
				</div>
			</div>
		</div>
	</div>

</div>

<script type="text/javascript">
$(function(){
	$("#preparTable").bootstrapTable({
		
		inconSize : 'sm',
		url:'${ctxPath}/ptsystems/menu4List?mettingId=${mettingId!}',
		striped : true,
		height:375,
		columns : [{
			radio : true
			
		}, {
			field : "projectId",
			title : '序号',
			formatter : function(value, row, index) {
				return index + 1;
			}
		}, {
			field : "specProCode",
			title : '项目编号',
			sortable : true
		}, {
			field : "projectTitle",
			title : '评审项目名称',
			sortable : true
		}, {
			field : "reviewResultName",
			title : '审批结果',
			sortable : true
		},{
			field : "appliedAmount",
			title : '申请金额',
			sortable : true
		},{
			field : "approvalDeptName",
			title : '需求提出部门',
			sortable : true
		},{
			field : "projectOrder",
			title : '排序号',
			sortable : true
		}]
	}); 
	
});

/* function preparMet(param){
	 alert(1)
	var params = {
			mode : 'page',
			width:'600px',
			height:'400px',
			url : "${ctxPath!}/test/toFunctionIndex",
			data:{projectId:param.projectId,functionCode:param.functionCode}
	};
	$.cuslayer(params);
} */


 $('#metDetail').click(function(){
	alert(1);
	var functionCod= "fun1302";
	
	var mettingId = $("#mettingId").val();
	alert(mettingId);
	var params = {
			mode : 'page',
			width:'600px',
			height:'400px',
			url : "${ctxPath!}/test/toFunctionIndex",
			data:{mettingId:mettingId,functionCode:functionCod}
	};
	$.cuslayer(params);
	
});

$('#addItemsList').click(function(){
	var functionCod= "fun1306";
	var mettingId = $("#mettingId").val();
	alert(mettingId);
	var params = {
			mode : 'page',
			width:'600px',
			height:'400px',
			url : "${ctxPath!}/test/toFunctionIndex",
			data:{mettingId:mettingId,functionCode:functionCod}
	};
	$.cuslayer(params);
	
});


//升序
function up(){
	 var all = $('#preparTable').bootstrapTable("getData");
	 var rows = $('#preparTable').bootstrapTable("getSelections");
	 if(rows.length <= 0){
		 layer.msg('<span class="red bigger-120">请先选择数据</span>');
	 }
	 var obj = rows[0];
	 if(obj.projectOrder!= all[0].projectOrder){//选中的排序号
		 var index1,index2;
		 var data1,data2;
		 var ids = [];
		 for(var i = 0; i<all.length; i++){//遍历所有的数据
			 if(all[i].projectOrder == obj.projectOrder){
				 ids.push(obj.projectOrder);//当前的
				 ids.push(all[i-1].projectOrder);//前一个
				 
				 index1 = i-1;//前一个位置索引
				 data1 = all[i];//当前
				
				 index2 = i;//当前位置索引
				 data2 = all[i-1];//前面
			 }
		 }
		 var row=rows[0];
		 var conferenceId = $("#mettingId").val();
		 $.post("${ctxPath!}/ptsystems/menu4/fun1309",
			{'projectId':row.projectId,'projectOrder':row.projectOrder,'conferenceId':conferenceId},
				function(result){
			 		if(result.code==1){
						 var a=data2.projectOrder; //前面
		 				var b=data1.projectOrder; //当前
		 				$('#preparTable').bootstrapTable('remove', {field: 'projectOrder', values: ids});//先删除触发的两行
		 				data2.projectOrder=b;
		 				data1.projectOrder=a;
						$('#preparTable').bootstrapTable('insertRow', {index: index1, row: data1});//插入第一行
						$('#preparTable').bootstrapTable('insertRow', {index: index2, row: data2});//插入第二行 
					}else{
						layer.msg("操作失败",2);
					}
				 },"json");
		 var select = $('#preparTable').bootstrapTable("getSelections");
		 var id = select[0].projectOrder;
		 if(id == all[0].projectOrder){
			 $("#up").removeClass("btn-purple");
			 $("#up").addClass(".disabled");
		 }else{
			 $("#up").removeClass(".disabled");
			 $("#up").addClass("btn-purple");
		 }
		 if(id == all[all.length-1].orderCode){
			 $("#down").removeClass("btn-purple");
			 $("#down").addClass(".disabled");
		 }else{
			 $("#down").removeClass(".disabled");
			 $("#down").addClass("btn-purple");
		 }
		 
	 }
}


//降序
function down(){
	 var all = $('#preparTable').bootstrapTable("getData");
	 var rows = $('#preparTable').bootstrapTable("getSelections");
	 if(rows.length <= 0){
		 layer.msg('<span class="red bigger-120">请先选择数据</span>');
	 }
	 var obj = rows[0];
	 if(obj.projectOrder != all[all.length-1].projectOrder){
		 var index1,index2;
		 var data1,data2;
		 var ids = [];
		 for(var i = 0; i<all.length; i++){
			 if(all[i].projectOrder == obj.projectOrder){
				 ids.push(obj.projectOrder);
				 ids.push(all[i+1].projectOrder);
				 
				 index1 = i; //当前
				 data1 = all[i+1]; //后面的
				 
				 index2 = i+1; //后面
				 data2 = all[i]; //当前的
			 }
		 }
		var row = rows[0];
		 var conferenceId = $("#mettingId").val();
		 $.post("${ctxPath!}/ptsystems/menu4/fun1310",
			{'projectId':row.projectId,'projectOrder':row.projectOrder,'conferenceId':conferenceId},
				function(result){
			 		if(result.code==1){
				 		//layer.msg("删除成功",1,1);
						 //$("#tableysxm").bootstrapTable('refresh');
			 			 var a=data1.projectOrder; //后面
						 var b=data2.projectOrder; //当前序号
						 $('#preparTable').bootstrapTable('remove', {field: 'projectOrder', values: ids});
						 data1.projectOrder = b;
						 data2.projectOrder = a;
						 $('#preparTable').bootstrapTable('insertRow', {index: index1, row: data1});
						 $('#preparTable').bootstrapTable('insertRow', {index: index2, row: data2});
					}else{
						layer.msg("操作失败",2);
					}
				 },"json");
		 var select = $('#preparTable').bootstrapTable("getSelections");
		 var id = select[0].projectOrder;
		 if(id == 1){
			 $("#up").removeClass("btn-purple");
			 $("#up").addClass(".disabled");
		 }else{
			 $("#up").removeClass(".disabled");
			 $("#up").addClass("btn-purple");
		 }
		 if(id == all.length){
			 $("#down").removeClass("btn-purple");
			 $("#down").addClass(".disabled");
		 }else{
			 $("#down").removeClass(".disabled");
			 $("#down").addClass("btn-purple");
		 }
	 }
}




</script>
